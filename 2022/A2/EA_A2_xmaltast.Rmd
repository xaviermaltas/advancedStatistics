---
title: "A2 - Anàlisi estadística I"
author: "Xavier Maltas Tarridas"
date: 'Novembre 2022'
output: 
  html_document:
    highlight: default
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_depth: 2
    includes:
      in_header: RMD-header.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_libraries, include=FALSE}
#Imports
library(knitr)
if (!require('plyr')) install.packages('plyr'); library('plyr')
if (!require('dplyr')) install.packages('dplyr'); library('dplyr')
if (!require('ggplot2')) install.packages('ggplot2'); library('ggplot2')
if (!require('gridExtra')) install.packages('gridExtra'); library('gridExtra')
if (!require('VIM')) install.packages('VIM'); library('VIM')
```

******
# Lectura del fitxer
******

```{r, echo=TRUE}
#Load file
df <- read.csv("gpa_clean.csv", sep=",")
```


******
# Estadística descriptiva i visualització
******

## Anàlisi descriptiva

Seguidament, podem observar un sumari dels valors de les variables numèriques i categòriques.

```{r, echo=TRUE}
##DF descriptive analysis
#Dimensions
dim(df)
#df structure
str(df)
#Head data sample
head(df)
#Summary
summary(df)
#Class per each var
sapply(df,class)
```


## Visualització

### Distribucions individuals

#### Distribució de la variable _'sat'_

Visualització de la distribució de la variable _'sat'_.

```{r, echo=TRUE}
# sat distribution
ggplot( df, aes(x=sat)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "sat Distribution")
```



#### Distribució de la variable _'colgpa'_

Visualització de la distribució de la variable _'colgpa'_.

```{r, echo=TRUE}
#colgpa distribution

#discrete var creation
discrete.colgpa <- df$colgpa
#plot
ggplot( df, aes(x=discrete.colgpa)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "sat Distribution")
```

### Distribucions sobre _'sat'_

#### Distribució _'sat'_ per _'female'_


Visualització de la distribució de la variable _'sat'_ en funció del gènere, variable _'female'_.

```{r, echo=TRUE}
##sat-female
df.female <- df %>% filter(female == TRUE)
df.male <- df %>% filter(female == FALSE)
#female
satfemale.ggplot <- ggplot( df.female, aes(x=sat)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "sat Distribution Female")
satfemale.ggplot

#male
satmale.ggplot <- ggplot( df.male, aes(x=sat)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "sat Distribution Male")
satmale.ggplot

#ggplot grid
#grid.arrange(satfemale.ggplot, satmale.ggplot, ncol=2)

```

#### Distribució _'sat'_ per _'athlete'_


Visualització de la distribució de la variable _'sat'_ en funció de si és o no atleta.

```{r, echo=TRUE}
##sat-athlete
df.athletes <- df %>% filter(athlete == TRUE)
df.noathletes <- df %>% filter(athlete == FALSE)

#athletes
satAthletes.ggplot <- ggplot( df.athletes, aes(x=sat)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "sat Distribution Athletes")
satAthletes.ggplot

#no athletes
satNoathletes.ggplot <- ggplot( df.noathletes, aes(x=sat)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "sat Distribution No Athletes")
satNoathletes.ggplot
```

#### Distribució _'sat'_ segons raça


Visualització de la distribució de la variable _'sat'_ en funció de la raça.

```{r, echo=TRUE}
##sat-race
df.white <- df %>% filter(white == TRUE)
df.black <- df %>% filter(black == FALSE)
df.noRace <- df %>% filter(black ==FALSE & white == FALSE)
count(df.noRace)

#white
satWhite.ggplot <- ggplot( df.white, aes(x=sat)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "sat Distribution White")
satWhite.ggplot

#black
satBlack.ggplot <- ggplot( df.black, aes(x=sat)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "sat Distribution Black")
satBlack.ggplot

#no race
satNorace.ggplot <- ggplot( df.noRace, aes(x=sat)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "sat Distribution No Race")
satNorace.ggplot
```

### Distribucions sobre _'colgpa'_

#### Distribució _'colgpa'_ per _'female'_


Visualització de la distribució de la variable _'colgpa'_ en funció del gènere, variable _'female'_.

```{r, echo=TRUE}
##colgpa-female
#female
colgpafemale.ggplot <- ggplot( df.female, aes(x=colgpa)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "colgpa Distribution Female")
colgpafemale.ggplot

#male
colgpamale.ggplot <- ggplot( df.male, aes(x=colgpa)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "colgpa Distribution Male")
colgpamale.ggplot

#ggplot grid
#grid.arrange(colgpafemale.ggplot, colgpamale.ggplot, ncol=2)

```

#### Distribució _'colgpa'_ per _'athlete'_


Visualització de la distribució de la variable _'colgpa'_ en funció de si és o no atleta.

```{r, echo=TRUE}
##colgpa-athlete
#athletes
colgpaAthletes.ggplot <- ggplot( df.athletes, aes(x=colgpa)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "colgpa Distribution Athletes")
colgpaAthletes.ggplot

#no athletes
colgpaNoathletes.ggplot <- ggplot( df.noathletes, aes(x=colgpa)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "colgpa Distribution No Athletes")
colgpaNoathletes.ggplot
```

#### Distribució _'colgpa'_ segons raça


Visualització de la distribució de la variable _'colgpa'_ en funció de la raça.

```{r, echo=TRUE}
##colgpa-race
#white
colgpaWhite.ggplot <- ggplot( df.white, aes(x=colgpa)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "colgpa Distribution White")
colgpaWhite.ggplot

#black
colgpaBlack.ggplot <- ggplot( df.black, aes(x=colgpa)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "colgpa Distribution Black")
colgpaBlack.ggplot

#no race
colgpaNorace.ggplot <- ggplot( df.noRace, aes(x=colgpa)) +
  geom_histogram( aes(y=..density..), colour="black", fill="lightblue")+
  geom_density(alpha=.2, fill="indianred3") + 
  labs(title = "colgpa Distribution No Race")
colgpaNorace.ggplot
```


### Interpretació dels gràfics

Amb la visualització dels gràfics corresponents a les distribucions de les variables _'sat'_ i _'colgpa'_, podem observar que ambdues mostres un comportament que té una tendència simètrica, tot i que, en el cas de la variable _'sat'_ es veu molt millor reflectit que en cas de la variable _'colgpa'_.

Centrant-nos exclusivament en els gràfics corresponents a la variable _'sat'_, podem afirmar que la distribució seguida d'aquesta variable en funció del gènere és pràcticament igual en els dos casos, amb un punt central al voltant dels 1000 punts. En el cas d'anàlisi en si són o no atletes, observem un canvi de paradigma. En el cas dels alumnes que són atletes, la distribució dels valors és molt més dispersa. Trobem més registres amb valors baixos de forma més freqüent i amb un punt central també més baix del vist en el gràfic dels alumnes que no són atletes. Finalment, si ens centrem en els valors segons la raça, podem veure una distribució pràcticament calcada tant si aquests són blancs com si són negres. Pel que fa als valors corresponents a les persones que no pertanyen a cap dels grups esmentats anteriorment, la distribució és molt dispersa com a conseqüència per la poca quantitat de registres que trobem en aquest cas concret.

Si ens fixem en la nota mitjana del primer semestre, variable _'colpga'_, en funció del gènere; podem veure que el punt central en el cas de les dones està situat sobre un valor major respecte al dels homes. Com a tal podem afirmar que durant aquest primer semestre les notes de forma mitjana tendeixen a ser superior per les dones. Si realitzem la comparativa en funció dels alumnes que són i no són atletes, observem que la valoració dels que no ho són, tendeix a ser superior, ja que principalment els valors es troben en un rang al voltant dels 3 punts, mentre que en el cas dels atletes, al voltant dels 2 punts. Finalment, si ens centrem en els valors segons la raça, podem veure una distribució pràcticament calcada tant si aquests són blancs com si són negres. Pel que fa als valors corresponents a les persones que no pertanyen a cap dels grups esmentats anteriorment, la distribució és molt dispersa com a conseqüència per la poca quantitat de registres que trobem en aquest cas concret.



******
# Interval de confiança de la mitjana poblacional de la variable _'sat'_ i _'colpga'_
******

## Supòsits

### _'sat'_

```{r, echo=TRUE}
#summary
summary(df$sat)

#metrics table
idx <- c("sat","colgpa")
mean <- as.vector(sapply(df[,idx], mean, na.rm=TRUE))
sd <- as.vector(sapply(df[,idx], sd, na.rm=TRUE))
median <- as.vector(sapply(df[,idx], median, na.rm=TRUE))
IQR <- as.vector(sapply(df[,idx],IQR, na.rm=TRUE))

#table creation
table.satcolgpa <- kable(data.frame(Variables=names(df[idx]),
                                Mean = mean,
                                StandardDeviation = sd,
                                Median = median,
                                IQR = IQR),digits=2, caption="Table")
table.satcolgpa


#sat Box plot
boxplot(df$sat, main="Sat Boxplot Distribution")

```

Observant les mètriques i gràfics podem suposar que el valor mitjà poblacional de la variable _'sat'_ es trobarà entre els valors 1000 i 1050.

### _'colgpa'_

```{r, echo=TRUE}
#summary
summary(df$colgpa)

#metrics table
idx <- c("sat","colgpa")
mean <- as.vector(sapply(df[,idx], mean, na.rm=TRUE))
sd <- as.vector(sapply(df[,idx], sd, na.rm=TRUE))
median <- as.vector(sapply(df[,idx], median, na.rm=TRUE))
IQR <- as.vector(sapply(df[,idx],IQR, na.rm=TRUE))

#table creation
table.satcolgpa <- kable(data.frame(Variables=names(df[idx]),
                                Mean = mean,
                                StandardDeviation = sd,
                                Median = median,
                                IQR = IQR),digits=2, caption="Table")
table.satcolgpa

#colgpa Box plot
boxplot(df$colgpa, main="Colgp Boxplot Distribution")
```

Observant les mètriques i gràfics podem suposar que el valor mitjà poblacional de la variable _'colgpa'_ es trobarà entre els valors 2.45 i 2.75.

## Funció de càlcul de l’interval de confiança

A continuació realitzem una funció anomenada IC que donat un vector de dades (x) i un nivell de confiança (NC), retorni els intervals de confiança de la mostra.

```{r, echo=TRUE}

IC <- function(x, NC) {
  n <- length(x)
  mean <- mean(x)
  sd <- sd(x)
  z <- abs(qnorm(((1-NC)/2)))
  errorst <- sd/sqrt(n)
  lim_inf <- mean - (z*errorst)
  lim_sup <- mean + (z*errorst)
  output <- data.frame(NC, n, mean, sd, z, errorst, lim_inf, lim_sup)
  return(output)
}

```

## Interval de confiança de la variable _'sat'_

Calculem els intervals de confiança de la variable _'sat'_ mitjançant la funció creada a l’apartat anterior. A la vegada, realitzem la comprovació del correcte funcionament de la nostra funció mitjançant la qual disposa R anomenada t.test.

```{r, echo=TRUE}
#Intervals de confinaça
ic95.sat <- IC(df$sat, 0.95)
ic95.sat
ic90.sat <- IC(df$sat, 0.90)
ic90.sat

#t.test
t.test(df$sat, conf.level = 0.95)
t.test(df$sat, conf.level = 0.90)
```

Observem que els resultats obtinguts d'ambdues funcions ens donen els mateixos intervals de confiança final en els dos casos. 

## Interval de confiança de la variable _'colgpa'_

Realitzarem el mateix procés per la variable _'colgpa'_. Còmput dels intervals de confiança i comprovació mitjançant t.test.

```{r, echo=TRUE}
#Intervals de confinaça
ic95.colgpa <- IC(df$colgpa, 0.95)
ic95.colgpa
ic90.colgpa <- IC(df$colgpa, 0.90)
ic90.colgpa

#t.test
t.test(df$colgpa, conf.level = 0.95)
t.test(df$colgpa, conf.level = 0.90)
```

Observem que els resultats obtinguts d'ambdues funcions ens donen els mateixos intervals de confiança final en els dos casos. 

## Interpretació

A l'hora d'interpretar els intervals de confiança obtinguts, podem concloure que si realitzem un mostreig amb quantitat elevada de mostres de la població, el percentatge (NC) dels intervals de confiança que hàgim obtingut d'aquestes mostres, contindran el valor de la mitjana poblacional.
Per tant, en el cas de la variable _'sat'_, el 95% dels valors aconseguits de la mostra, es trobaran continguts dins l'interval de confiança [1026.083, 1034.579].
